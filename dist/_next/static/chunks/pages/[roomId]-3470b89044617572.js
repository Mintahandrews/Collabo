(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{7933:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomId]",function(){return n(768)}])},5650:function(e,t,n){"use strict";n.d(t,{r:function(){return o}});let o=[...Object.values({PURPLE:"#6B32F3",BLUE:"#408FF8",RED:"#F32D27",GREEN:"#6FCB12",GOLD:"#A89D6C",PINK:"#EB29DA",MINT:"#19CB87",RED_LIGHT:"#ED7878",CYAN:"#02CBF6",RED_DARK:"#BA1555",ORANGE:"#FF7300"})]},9283:function(e,t,n){"use strict";n.d(t,{W:function(){return r}});var o=n(9922);let r=(0,o.ZP)((()=>{{let e=window.location.protocol,t=window.location.host;return"".concat(e,"//").concat(t)}})(),{reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,transports:["websocket","polling"],forceNew:!0,autoConnect:!0,path:"/socket.io"});r.on("connect",()=>{console.log("Socket connected successfully")}),r.on("disconnect",e=>{console.log("Socket disconnected: ".concat(e)),("transport close"===e||"ping timeout"===e)&&(console.log("Attempting to reconnect..."),setTimeout(()=>{r.connect()},1e3))}),r.on("connect_error",e=>{console.error("Socket connection error:",e),setTimeout(()=>{console.log("Attempting to reconnect after error..."),r.connect()},1e3)}),r.on("reconnect",e=>{console.log("Socket reconnected after ".concat(e," attempts"))}),r.on("reconnect_error",e=>{console.error("Socket reconnect error:",e)}),r.on("reconnect_failed",()=>{console.error("Socket reconnection failed after all attempts"),setTimeout(()=>{console.log("Attempting to reconnect after failure..."),r.connect()},2e3)})},5323:function(e,t,n){"use strict";n.d(t,{NW:function(){return o.NW},av:function(){return o.av},bo:function(){return o.bo},u4:function(){return o.u4}}),n(2305);var o=n(5222)},2305:function(e,t,n){"use strict";n.d(t,{X:function(){return a},p:function(){return r}});var o=n(2804);let r={id:"",userId:"",users:new Map,usersMoves:new Map,movesWithoutUser:[],myMoves:[]},a=(0,o.cn)({key:"roomState",default:r})},5222:function(e,t,n){"use strict";n.d(t,{av:function(){return u},NW:function(){return s},bb:function(){return l},u4:function(){return c},bo:function(){return d}});var o=n(2804),r=n(5650);let a=e=>{let t=r.r.findIndex(t=>t===e);return -1===t?r.r[0]:r.r[(t+1)%r.r.length]};var i=n(2305);let s=()=>{let e=(0,o.sJ)(i.X);return e},l=()=>{let e=(0,o.Zl)(i.X);return e},c=()=>{let e=(0,o.Zl)(i.X);return t=>{e({...i.p,id:t})}},d=()=>{let e=(0,o.Zl)(i.X);return{handleAddUser:(t,n)=>{e(e=>{var o;let r=e.users,i=e.usersMoves,s=a(null===(o=[...r.values()].pop())||void 0===o?void 0:o.color);return r.set(t,{name:n,color:s}),i.set(t,[]),{...e,users:r,usersMoves:i}})},handleRemoveUser:t=>{e(e=>{let n=e.users,o=e.usersMoves,r=o.get(t);n.delete(t),o.delete(t);let a=Array.isArray(e.movesWithoutUser)?e.movesWithoutUser:[];return{...e,users:n,usersMoves:o,movesWithoutUser:[...a,...r||[]]}})},handleAddMoveToUser:(t,n)=>{e(e=>{let o=e.usersMoves,r=e.usersMoves.get(t);return o.set(t,[...r||[],n]),{...e,usersMoves:o}})},handleRemoveMoveFromUser:t=>{e(e=>{let n=e.usersMoves,o=e.usersMoves.get(t);return null==o||o.pop(),n.set(t,o||[]),{...e,usersMoves:n}})}}},u=()=>{let[e,t]=(0,o.FV)(i.X);return{handleAddMyMove:e=>{t(t=>{var n;return(null===(n=t.myMoves[t.myMoves.length-1])||void 0===n?void 0:n.options.mode)==="select"?{...t,myMoves:[...t.myMoves.slice(0,t.myMoves.length-1),e]}:{...t,myMoves:[...t.myMoves,e]}})},handleRemoveMyMove:()=>{let n=[...e.myMoves],o=n.pop();return t(e=>({...e,myMoves:n})),o},myMoves:e.myMoves}}},9477:function(e,t,n){"use strict";var o=n(5893),r=n(8193),a=n(4922);t.Z=e=>{let{id:t}=e,{closeModal:n}=(0,a.d)();return(0,o.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10 ",children:[(0,o.jsx)("button",{onClick:n,className:"absolute top-5 right-5",children:(0,o.jsx)(r.oHP,{})}),(0,o.jsxs)("h2",{className:"text-lg font-bold",children:['Room with id "',t,'" does not exist or is full!']}),(0,o.jsx)("h3",{children:"Try to join room later."})]})}},768:function(e,t,n){"use strict";let o;n.r(t),n.d(t,{default:function(){return eY}});var r=n(5893),a=n(5323),i=n(7294),s=n(4960),l=n(2947),c=n(5650),d=n(9283),u=n(5222);let h=(0,i.createContext)(null);var m=e=>{let{children:t}=e,n=(0,u.bb)(),{users:o}=(0,u.NW)(),{handleAddUser:m,handleRemoveUser:g}=(0,a.bo)(),f=(0,i.useRef)(null),x=(0,i.useRef)(null),p=(0,i.useRef)(null),v=(0,i.useRef)(null),b=(0,i.useRef)(null),w=(0,i.useRef)([]),[y,C]=(0,i.useState)({base64:""}),j=(0,s.c)(0),k=(0,s.c)(0);return(0,i.useEffect)(()=>(d.W.on("room",(e,t,o)=>{let r=new Map(JSON.parse(t)),a=new Map(JSON.parse(o)),i=new Map;a.forEach((e,t)=>{if(t===d.W.id)return;let n=[...a.keys()].indexOf(t),o=c.r[n%c.r.length];i.set(t,{name:e,color:o})}),n(t=>({...t,users:i,usersMoves:r,movesWithoutUser:e.drawn}))}),d.W.on("new_user",(e,t)=>{(0,l.Am)("".concat(t," has joined the room."),{position:"top-center",theme:"colored"}),m(e,t)}),d.W.on("user_disconnected",e=>{var t;(0,l.Am)("".concat((null===(t=o.get(e))||void 0===t?void 0:t.name)||"Anonymous"," has left the room."),{position:"top-center",theme:"colored"}),g(e)}),()=>{d.W.off("room"),d.W.off("new_user"),d.W.off("user_disconnected")}),[m,g,n,o]),(0,r.jsx)(h.Provider,{value:{x:j,y:k,bgRef:v,undoRef:f,redoRef:x,canvasRef:p,setMoveImage:C,moveImage:y,minimapRef:b,selectionRefs:w},children:t})},g=n(3830),f=n(3750),x=n(3493),p=n.n(x);let v={width:4e3,height:2e3},b=()=>{let[e,t]=(0,i.useState)(0),[n,o]=(0,i.useState)(0);return(0,i.useEffect)(()=>{let e=()=>{t(window.innerWidth),o(window.innerHeight)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),{width:e,height:n}},w=()=>{let{x:e,y:t}=(0,i.useContext)(h);return{x:e,y:t}},y=()=>{let{undoRef:e,bgRef:t,canvasRef:n,minimapRef:o,redoRef:r,selectionRefs:a}=(0,i.useContext)(h);return{undoRef:e,redoRef:r,bgRef:t,canvasRef:n,minimapRef:o,selectionRefs:a}},C=()=>{let{canvasRef:e}=y(),[t,n]=(0,i.useState)();return(0,i.useEffect)(()=>{var t;let o=null===(t=e.current)||void 0===t?void 0:t.getContext("2d");o&&(o.lineJoin="round",o.lineCap="round",n(o))},[e]),t},j={circle:{cX:0,cY:0,radiusX:0,radiusY:0},rect:{width:0,height:0},path:[],options:{shape:"line",mode:"draw",lineWidth:1,lineColor:{r:0,g:0,b:0,a:0},fillColor:{r:0,g:0,b:0,a:0},selection:null},id:"",img:{base64:""},timestamp:0},k=(e,t)=>e-t.get(),E=e=>"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(e.a,")");var N=n(2804);let S=(0,N.cn)({key:"options",default:{lineColor:{r:0,g:0,b:0,a:1},fillColor:{r:0,g:0,b:0,a:0},lineWidth:5,mode:"draw",shape:"line",selection:null}}),T=()=>{let e=(0,N.sJ)(S);return e},M=()=>{let e=(0,N.Zl)(S);return e},R=()=>{let e=(0,N.FV)(S);return e},I=()=>{let e=M();return{setSelection:t=>{e(e=>({...e,selection:t}))},clearSelection:()=>{e(e=>({...e,selection:null}))}}},W=(0,N.cn)({key:"saved_moves",default:[]}),L=()=>{let e=(0,N.Zl)(W);return{addSavedMove:t=>{"select"!==t.options.mode&&e(e=>[t,...e])},removeSavedMove:()=>{let t;return e(e=>(t=e.at(0),e.slice(1))),t},clearSavedMoves:()=>{e([])}}},A=()=>{let e=(0,N.sJ)(W);return e},P=(e,t,n,o)=>{let r=e-n[0],a=t-n[1];return o?Math.abs(r)>Math.abs(a)?r=r>0&&a<0||r<0&&a>0?-a:a:a=a>0&&r<0||a<0&&r>0?-r:r:(r=e-n[0],a=t-n[1]),{width:r,height:a}},D=(e,t,n,o,r)=>{e.beginPath();let{width:a,height:i}=P(n,o,t,r),s=t[0]+a/2,l=t[1]+i/2,c=Math.abs(a/2),d=Math.abs(i/2);return e.ellipse(s,l,c,d,0,0,2*Math.PI),e.stroke(),e.fill(),e.closePath(),{cX:s,cY:l,radiusX:c,radiusY:d}},_=(e,t,n,o,r,a)=>{e.beginPath();let{width:i,height:s}=P(n,o,t,r);return a?e.fillRect(t[0],t[1],i,s):e.rect(t[0],t[1],i,s),e.stroke(),e.fill(),e.closePath(),{width:i,height:s}},F=(e,t,n,o,r)=>{if(r){e.beginPath(),e.lineTo(t[0],t[1]),e.lineTo(n,o),e.stroke(),e.closePath();return}e.lineTo(n,o),e.stroke()},z=[],O={cX:0,cY:0,radiusX:0,radiusY:0},X={width:0,height:0},U=e=>{let t=T(),n=w(),{clearSavedMoves:r}=L(),{handleAddMyMove:s}=(0,a.av)(),{setSelection:l,clearSelection:c}=I(),u=n.x,h=n.y,[m,g]=(0,i.useState)(!1),f=C(),x=()=>{f&&(f.lineWidth=t.lineWidth,f.strokeStyle=E(t.lineColor),f.fillStyle=E(t.fillColor),"eraser"===t.mode?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="source-over")},p=()=>{o||(o=null==f?void 0:f.getImageData(0,0,f.canvas.width,f.canvas.height)),o&&(null==f||f.putImageData(o,0,0))},v=()=>{p(),o=void 0};return{handleEndDrawing:()=>{if(!f||e)return;g(!1),f.closePath();let n=!0;if("select"===t.mode&&z.length){v();let e=z[0][0],t=z[0][1],o=z[z.length-1][0]-e,r=z[z.length-1][1]-t;o<0?(o-=4,e+=2):(o+=4,e-=2),r<0?(r-=4,t+=2):(r+=4,t-=2),(o<4||o>4)&&(r<4||r>4)?l({x:e,y:t,width:o,height:r}):(c(),n=!1)}let o={...j,rect:{...X},circle:{...O},path:z,options:t};z=[],O={cX:0,cY:0,radiusX:0,radiusY:0},X={width:0,height:0},"select"!==t.mode?(d.W.emit("draw",o),r()):n&&s(o)},handleDraw:(n,o,r)=>{if(!f||!m||e)return;let[a,i]=[k(n,u),k(o,h)];if(p(),"select"===t.mode){f.fillStyle="rgba(0, 0, 0, 0.2)",_(f,z[0],a,i,!1,!0),z.push([a,i]),x();return}switch(t.shape){case"line":r&&(z=z.slice(0,1)),F(f,z[0],a,i,r),z.push([a,i]);break;case"circle":O=D(f,z[0],a,i,r);break;case"rect":X=_(f,z[0],a,i,r)}},handleStartDrawing:(n,o)=>{if(!f||e||e)return;let[r,a]=[k(n,u),k(o,h)];g(!0),x(),p(),"line"===t.shape&&"select"!==t.mode&&(f.beginPath(),f.lineTo(r,a),f.stroke()),z.push([r,a])},drawing:m,clearOnYourMove:v}},V=(0,N.cn)({key:"bg",default:{mode:"light",lines:!0}}),Z=()=>{let e=(0,N.sJ)(V);return(0,i.useEffect)(()=>{let t=window.document.documentElement;"dark"===e.mode?(t.classList.remove("light"),t.classList.add("dark")):(t.classList.remove("dark"),t.classList.add("light"))},[e.mode]),e},B=()=>{let e=(0,N.Zl)(V);return(t,n)=>{e({mode:t,lines:n})}},H=()=>{let{moveImage:e,setMoveImage:t}=(0,i.useContext)(h);return{moveImage:e,setMoveImage:t}},J={x:0,y:0,width:0,height:0},Y=e=>{let t=C(),n=T(),{selection:o}=n,{bgRef:r,selectionRefs:a}=y(),{setMoveImage:s}=H();(0,i.useEffect)(()=>{let n=async()=>{t&&o&&(await e(),setTimeout(()=>{let{x:e,y:n,width:r,height:a}=o;t.lineWidth=2,t.strokeStyle="#000",t.setLineDash([5,10]),t.globalCompositeOperation="source-over",t.beginPath(),t.rect(e,n,r,a),t.stroke(),t.closePath(),t.setLineDash([])},10))};return(J.width!==(null==o?void 0:o.width)||J.height!==(null==o?void 0:o.height)||J.x!==(null==o?void 0:o.x)||J.y!==(null==o?void 0:o.y))&&n(),()=>{o&&(J=o)}},[o,t]);let c=(0,i.useMemo)(()=>{if(o){let{x:e,y:t,width:n,height:r}=o;return n<0?(n+=4,e-=2):(n-=4,e+=2),r<0?(r+=4,t-=2):(r-=4,t+=2),{x:e,y:t,width:n,height:r}}return{width:0,height:0,x:0,y:0}},[o]),u=async e=>{var n;if(!o)return null;let{x:a,y:i,width:s,height:l}=c,d=null==t?void 0:t.getImageData(a,i,s,l);if(d){let t=document.createElement("canvas");t.width=s,t.height=l;let o=document.createElement("canvas");o.width=s,o.height=l;let c=o.getContext("2d");if(c&&r.current){let u=null===(n=r.current.getContext("2d"))||void 0===n?void 0:n.getImageData(a,i,s,l);u&&e&&c.putImageData(u,0,0);let h=t.getContext("2d");null==h||h.putImageData(d,0,0),c.drawImage(t,0,0);let m=await new Promise(e=>{o.toBlob(t=>{t&&e(t)})});return m}}return null},h=()=>{if(!o)return null;let{x:e,y:t,width:r,height:a}=c;r<0?(r+=4,e-=2):(r-=4,e+=2),a<0?(a+=4,t-=2):(a-=4,t+=2);let i={...j,rect:{width:r,height:a},path:[[e,t]],options:{...n,shape:"rect",mode:"eraser",fillColor:{r:0,g:0,b:0,a:1}}};return d.W.emit("draw",i),i},m=async()=>{let e=await u(!0);e&&navigator.clipboard.write([new ClipboardItem({"image/png":e})]).then(()=>{(0,l.Am)("Copied to clipboard!",{position:"top-center",theme:"colored"})})};(0,i.useEffect)(()=>{let e=async e=>{"c"===e.key&&e.ctrlKey&&m(),"Delete"===e.key&&o&&h()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[r,h,t,m,u,n,o]),(0,i.useEffect)(()=>{let e=async()=>{if(o){let e=await u();if(!e)return;let{x:t,y:n,width:o,height:r}=c,a=new FileReader;a.readAsDataURL(e),a.addEventListener("loadend",()=>{var e;let i=null===(e=a.result)||void 0===e?void 0:e.toString();i&&(h(),s({base64:i,x:Math.min(t,t+o),y:Math.min(n,n+r)}))})}};if(a.current){let t=a.current[0],n=a.current[1],o=a.current[2];return t.addEventListener("click",e),n.addEventListener("click",m),o.addEventListener("click",h),()=>{null==t||t.removeEventListener("click",e),null==n||n.removeEventListener("click",m),null==o||o.removeEventListener("click",h)}}return()=>{}},[h,c,m,u,o,a,s])},G=0,q=e=>{let{canvasRef:t,minimapRef:n,bgRef:o}=y(),r=(0,a.NW)(),{handleAddMyMove:s,handleRemoveMyMove:l}=(0,a.av)(),{addSavedMove:c,removeSavedMove:u}=L(),h=C(),m=Z(),{clearSelection:g}=I(),f=(0,i.useMemo)(()=>{let{usersMoves:e,movesWithoutUser:t=[],myMoves:n=[]}=r,o=[...t,...n];return e.forEach(e=>o.push(...e)),o.sort((e,t)=>e.timestamp-t.timestamp),o},[r]),x=()=>{if(t.current&&n.current&&o.current){let e=n.current.getContext("2d");e&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(o.current,0,0,e.canvas.width,e.canvas.height),e.drawImage(t.current,0,0,e.canvas.width,e.canvas.height))}};(0,i.useEffect)(()=>x(),[m]);let p=(e,t)=>{let{path:n}=e;if(!h||!n.length)return;let o=e.options;if("select"!==o.mode){switch(h.lineWidth=o.lineWidth,h.strokeStyle=E(o.lineColor),h.fillStyle=E(o.fillColor),"eraser"===o.mode?h.globalCompositeOperation="destination-out":h.globalCompositeOperation="source-over","image"===o.shape&&t&&h.drawImage(t,n[0][0],n[0][1]),o.shape){case"line":h.beginPath(),n.forEach(e=>{let[t,n]=e;h.lineTo(t,n)}),h.stroke(),h.closePath();break;case"circle":{let{cX:t,cY:n,radiusX:o,radiusY:r}=e.circle;h.beginPath(),h.ellipse(t,n,o,r,0,0,2*Math.PI),h.stroke(),h.fill(),h.closePath();break}case"rect":{let{width:t,height:o}=e.rect;h.beginPath(),h.rect(n[0][0],n[0][1],t,o),h.stroke(),h.fill(),h.closePath()}}x()}},v=async()=>{if(!h)return;h.clearRect(0,0,h.canvas.width,h.canvas.height);let e=await Promise.all(f.filter(e=>"image"===e.options.shape).map(e=>new Promise(t=>{let n=new Image;n.src=e.img.base64,n.id=e.id,n.addEventListener("load",()=>t(n))})));f.forEach(t=>{if("image"===t.options.shape){let n=e.find(e=>e.id===t.id);n&&p(t,n)}else p(t)}),x()};Y(v),(0,i.useEffect)(()=>(d.W.on("your_move",t=>{e(),s(t),setTimeout(g,100)}),()=>{d.W.off("your_move")}),[e,g,s]),(0,i.useEffect)(()=>{if(G>=f.length||!G)v();else{let e=f[f.length-1];if("image"===e.options.shape){let t=new Image;t.src=e.img.base64,t.addEventListener("load",()=>p(e,t))}else p(e)}return()=>{G=f.length}},[f]);let b=()=>{if(h){let e=l();(null==e?void 0:e.options.mode)==="select"?g():e&&(c(e),d.W.emit("undo"))}},w=()=>{if(h){let e=u();e&&d.W.emit("draw",e)}};return(0,i.useEffect)(()=>{let e=e=>{"z"===e.key&&e.ctrlKey?b():"y"===e.key&&e.ctrlKey&&w()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[b,w]),{handleUndo:b,handleRedo:w}},K=e=>{let{handleAddMoveToUser:t,handleRemoveMoveFromUser:n}=(0,a.bo)();(0,i.useEffect)(()=>{let n;let o="";return d.W.on("user_draw",(r,a)=>{e?(n=r,o=a):t(a,r)}),()=>{d.W.off("user_draw"),n&&o&&t(o,n)}},[e,t]),(0,i.useEffect)(()=>(d.W.on("user_undo",e=>{n(e)}),()=>{d.W.off("user_undo")}),[n])};var Q=e=>{let{bgRef:t}=e,n=Z(),{x:o,y:a}=w();return(0,i.useEffect)(()=>{var e;let o=null===(e=t.current)||void 0===e?void 0:e.getContext("2d");if(o&&(o.fillStyle="dark"===n.mode?"#222":"#fff",o.fillRect(0,0,v.width,v.height),document.body.style.backgroundColor="dark"===n.mode?"#222":"#fff",n.lines)){o.lineWidth=1,o.strokeStyle="dark"===n.mode?"#444":"#ddd";for(let e=0;e<v.height;e+=25)o.beginPath(),o.moveTo(0,e),o.lineTo(o.canvas.width,e),o.stroke();for(let e=0;e<v.width;e+=25)o.beginPath(),o.moveTo(e,0),o.lineTo(e,o.canvas.height),o.stroke()}},[t,n]),(0,r.jsx)(g.E.canvas,{ref:t,width:v.width,height:v.height,className:"absolute top-0 bg-zinc-100",style:{x:o,y:a}})},$=e=>{let{dragging:t}=e,{minimapRef:n}=y(),o=w(),{width:a,height:l}=b(),[c,d]=(0,i.useState)(0),[u,h]=(0,i.useState)(0),[m,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!m){let e=o.x.onChange(d);return e}return()=>{}},[o.x,m]),(0,i.useEffect)(()=>{if(!m){let e=o.y.onChange(h);return e}return()=>{}},[o.y,m]);let x=(0,i.useRef)(null),p=(0,s.c)(0),C=(0,s.c)(0),j=(0,i.useMemo)(()=>a>1600?7:a>1e3?10:a>600?14:20,[a]);return(0,i.useEffect)(()=>(p.onChange(e=>{t||o.x.set(Math.floor(-e*j))}),C.onChange(e=>{t||o.y.set(Math.floor(-e*j))}),()=>{p.clearListeners(),C.clearListeners()}),[o.x,o.y,j,t,p,C]),(0,r.jsxs)("div",{className:"absolute right-10 top-10 z-30 overflow-hidden rounded-lg shadow-lg",style:{width:v.width/j,height:v.height/j},ref:x,children:[(0,r.jsx)("canvas",{ref:n,width:v.width,height:v.height,className:"h-full w-full"}),(0,r.jsx)(g.E.div,{drag:!0,dragConstraints:x,dragElastic:0,dragTransition:{power:0,timeConstant:0},onDragStart:()=>f(!0),onDragEnd:()=>f(!1),className:"absolute top-0 left-0 cursor-grab rounded-lg border-2 border-red-500",style:{width:a/j,height:l/j,x:p,y:C},animate:{x:-c/j,y:-u/j},transition:{duration:0}})]})},ee=()=>{let{canvasRef:e,bgRef:t,undoRef:n,redoRef:o}=y(),{width:a,height:s}=b(),{x:l,y:c}=w(),u=C(),[h,m]=(0,i.useState)(!0),[x,j]=(0,i.useState)([]),{handleEndDrawing:k,handleDraw:E,handleStartDrawing:N,drawing:S,clearOnYourMove:T}=U(h);K(S);let{handleUndo:M,handleRedo:R}=q(T),I=(0,i.useCallback)(p()(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];E(e,t,n)},5),[E]);return(0,i.useEffect)(()=>{m(!1)},[]),(0,i.useEffect)(()=>{let e=e=>{m(e.ctrlKey)};window.addEventListener("keyup",e),window.addEventListener("keydown",e);let t=n.current,r=o.current;return null==t||t.addEventListener("click",M),null==r||r.addEventListener("click",R),()=>{window.removeEventListener("keyup",e),window.removeEventListener("keydown",e),null==t||t.removeEventListener("click",M),null==r||r.removeEventListener("click",R)}},[e,h,R,M,o,n]),(0,i.useEffect)(()=>{u&&d.W.emit("joined_room")},[u]),(0,r.jsxs)("div",{className:"relative h-full w-full overflow-hidden",children:[(0,r.jsx)(g.E.canvas,{ref:e,width:v.width,height:v.height,className:"absolute top-0 z-10 ".concat(h&&"cursor-move"," touch-none"),style:{x:l,y:c},drag:h,dragConstraints:{left:-(v.width-a),right:0,top:-(v.height-s),bottom:0},dragElastic:0,dragTransition:{power:0,timeConstant:0},onMouseDown:e=>N(e.clientX,e.clientY),onMouseUp:k,onMouseMove:e=>{I(e.clientX,e.clientY,e.shiftKey)},onTouchStart:e=>{e.touches.length>=2?(m(!0),j(Array.from(e.touches))):N(e.touches[0].clientX,e.touches[0].clientY),e.preventDefault()},onTouchEnd:e=>{e.touches.length<2&&(x.length>=2&&setTimeout(()=>{m(!1)},100),j(Array.from(e.touches)),k()),e.preventDefault()},onTouchMove:e=>{e.touches.length>=2?j(Array.from(e.touches)):h||I(e.touches[0].clientX,e.touches[0].clientY),e.preventDefault()}}),(0,r.jsx)(Q,{bgRef:t}),(0,r.jsx)($,{dragging:h}),(0,r.jsx)("button",{className:"absolute bottom-14 right-5 z-10 rounded-xl md:bottom-5 ".concat(h?"bg-green-500":"bg-zinc-300 text-black"," p-3 text-lg text-white"),onClick:()=>m(e=>!e),"aria-label":h?"Switch to drawing mode":"Switch to move mode",children:(0,r.jsx)(f.Ctn,{})})]})},et=n(8933),en=n(3337),eo=()=>{let{x:e,y:t}=w(),n=(0,i.useRef)({x:0,y:0}),o=(0,i.useRef)(null),{docX:a,docY:s}=(0,et.Z)(o),l=window.matchMedia("(pointer: coarse)").matches;return((0,en.Z)(()=>{n.current.x===a&&n.current.y===s||l||(d.W.emit("mouse_move",k(a,e),k(s,t)),n.current={x:a,y:s})},150),l)?null:(0,r.jsxs)(g.E.div,{ref:o,className:"pointer-events-none absolute top-0 left-0 z-50 select-none transition-colors dark:text-white",animate:{x:a+15,y:s+15},transition:{duration:.05,ease:"linear"},children:[k(a,e).toFixed(0)," | ",k(s,t).toFixed(0)]})},er=e=>{var t,n;let{userId:o}=e,{users:s}=(0,a.NW)(),l=w(),[c,u]=(0,i.useState)(""),[h,m]=(0,i.useState)(l.x.get()),[x,p]=(0,i.useState)(l.y.get()),[v,b]=(0,i.useState)({x:-1,y:-1});return(0,i.useEffect)(()=>{d.W.on("mouse_moved",(e,t,n)=>{n===o&&b({x:e,y:t})});let e=(e,t)=>{e===o&&(u(t),setTimeout(()=>{u("")},3e3))};return d.W.on("new_msg",e),()=>{d.W.off("mouse_moved"),d.W.off("new_msg",e)}},[o]),(0,i.useEffect)(()=>{let e=l.x.onChange(m);return e},[l.x]),(0,i.useEffect)(()=>{let e=l.y.onChange(p);return e},[l.y]),(0,r.jsxs)(g.E.div,{className:"pointer-events-none absolute top-0 left-0 z-20 text-blue-800 ".concat(-1===v.x&&"hidden"),style:{color:null===(t=s.get(o))||void 0===t?void 0:t.color},animate:{x:v.x+h,y:v.y+x},transition:{duration:.2,ease:"linear"},children:[(0,r.jsx)(f.BKo,{className:"-rotate-90"}),c&&(0,r.jsx)("p",{className:"absolute top-full left-5 max-h-20 max-w-[15rem] overflow-hidden text-ellipsis rounded-md bg-zinc-900 p-1 px-3 text-white",children:c}),(0,r.jsx)("p",{className:"ml-2",children:(null===(n=s.get(o))||void 0===n?void 0:n.name)||"Anonymous"})]})},ea=()=>{let{users:e}=(0,a.NW)();return(0,r.jsx)(r.Fragment,{children:[...e.keys()].map(e=>e===d.W.id?null:(0,r.jsx)(er,{userId:e},e))})},ei=n(8193),es=()=>{let{canvasRef:e}=y(),{x:t,y:n}=w(),{moveImage:o,setMoveImage:a}=H(),l=(0,s.c)(o.x||50),c=(0,s.c)(o.y||50);return((0,i.useEffect)(()=>{o.x?l.set(o.x):l.set(50),o.y?c.set(o.y):c.set(50)},[l,c,o.x,o.y]),o.base64)?(0,r.jsxs)(g.E.div,{drag:!0,dragConstraints:e,dragElastic:0,dragTransition:{power:.03,timeConstant:50},className:"absolute top-0 z-20 cursor-grab",style:{x:l,y:c},children:[(0,r.jsxs)("div",{className:"absolute bottom-full mb-2 flex gap-3",children:[(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",onClick:()=>{let[e,r]=[k(l.get(),t),k(c.get(),n)],i={...j,img:{base64:o.base64},path:[[e,r]],options:{...j.options,selection:null,shape:"image"}};d.W.emit("draw",i),a({base64:""}),l.set(50),c.set(50)},children:(0,r.jsx)(ei.bzc,{})}),(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",onClick:()=>a({base64:""}),children:(0,r.jsx)(ei.oHP,{})})]}),(0,r.jsx)("img",{className:"pointer-events-none",alt:"image to place",src:o.base64})]}):null},el=n(6893),ec=()=>{let e,t;let{selection:n}=T(),{selectionRefs:o}=y();if(n){let{x:o,y:r,width:a,height:i}=n;e=Math.min(r,r+i)-40,t=Math.min(o,o+a)}else t=-40,e=-40;return(0,r.jsxs)("div",{className:"absolute top-0 left-0 z-50 flex items-center justify-center gap-2",style:{top:e,left:t},children:[(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:e=>{e&&o.current&&(o.current[0]=e)},children:(0,r.jsx)(f.Ctn,{})}),(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:e=>{e&&o.current&&(o.current[1]=e)},children:(0,r.jsx)(el.C3L,{})}),(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:e=>{e&&o.current&&(o.current[2]=e)},children:(0,r.jsx)(ei.VPh,{})})]})},ed=n(9583),eu=n(155),eh=n(1515),em=n(6694),eg=()=>{let[e,t]=(0,i.useState)("");return(0,r.jsxs)("form",{className:"flex w-full items-center gap-2",onSubmit:n=>{n.preventDefault(),d.W.emit("send_msg",e),t("")},children:[(0,r.jsx)("input",{className:"w-full rounded-xl border border-zinc-300 p-5 py-1",value:e,onChange:e=>t(e.target.value)}),(0,r.jsx)("button",{className:"btn-icon h-full w-10 bg-black",type:"submit",children:(0,r.jsx)(ei.gYb,{})})]})},ef=e=>{let{userId:t,msg:n,username:o,color:a}=e,i=d.W.id===t;return(0,r.jsxs)("div",{className:"my-2 flex gap-2 text-clip ".concat(i&&"justify-end text-right"),children:[!i&&(0,r.jsx)("h5",{style:{color:a},className:"font-bold",children:o}),(0,r.jsx)("p",{style:{wordBreak:"break-all"},children:n})]})},ex=n(5434),ep=class{setupSocketListeners(){this.socket.on("webrtc_offer",async(e,t)=>{try{console.log("Received WebRTC offer from ".concat(t));let n=await this.createPeerConnection(t);await n.connection.setRemoteDescription(new RTCSessionDescription(e));let o=await n.connection.createAnswer();await n.connection.setLocalDescription(o),this.socket.emit("webrtc_answer",o,t),this.addPendingIceCandidates(t),this.setConnectionTimeout(t)}catch(e){console.error("Error handling WebRTC offer:",e),this.emitConnectionError(t,"offer-error")}}),this.socket.on("webrtc_answer",async(e,t)=>{try{console.log("Received WebRTC answer from ".concat(t));let n=this.peerConnections.get(t);n?(await n.connection.setRemoteDescription(new RTCSessionDescription(e)),this.addPendingIceCandidates(t)):console.warn("No peer connection found for user ".concat(t))}catch(e){console.error("Error handling WebRTC answer:",e),this.emitConnectionError(t,"answer-error")}}),this.socket.on("webrtc_ice_candidate",async(e,t)=>{try{console.log("Received ICE candidate from ".concat(t),e);let n=this.peerConnections.get(t);n&&n.connection.remoteDescription?await n.connection.addIceCandidate(new RTCIceCandidate(e)):n?(n.pendingIceCandidates||(n.pendingIceCandidates=[]),n.pendingIceCandidates.push(e)):console.warn("No peer connection found for ".concat(t," to add ICE candidate"))}catch(e){console.error("Error handling ICE candidate:",e)}}),this.socket.on("user_disconnected",e=>{console.log("User disconnected: ".concat(e)),this.removePeerConnection(e)}),this.socket.on("webrtc_reconnect_request",e=>{console.log("Reconnect request from ".concat(e)),this.handleReconnectRequest(e)}),this.socket.on("connect",()=>{console.log("Socket connected - WebRTC signaling available"),this.peerConnections.forEach((e,t)=>{this.restartIceForPeer(t)})}),this.socket.on("disconnect",()=>{console.log("Socket disconnected - WebRTC signaling unavailable"),window.dispatchEvent(new CustomEvent("webrtc-signaling-disconnected",{detail:{message:"Signaling server disconnected. Reconnecting..."}}))})}setConnectionTimeout(e){let t=this.peerConnections.get(e);if(t){t.connectionTimeout&&clearTimeout(t.connectionTimeout);let n=this.reconnectAttempts.get(e)||0,o=Math.min(15e3*Math.pow(1.5,n),this.connectionTimeoutDuration);console.log("Setting connection timeout for ".concat(e," of ").concat(o,"ms (attempt ").concat(n+1,")")),t.connectionTimeout=setTimeout(()=>{let t=this.peerConnections.get(e);t&&"connected"!==t.connection.iceConnectionState&&"completed"!==t.connection.iceConnectionState&&(console.warn("Connection timeout for peer ".concat(e)),window.dispatchEvent(new CustomEvent("peer-connection-timeout",{detail:{userId:e,message:"Call connection timed out. Please try again."}})),this.attemptReconnect(e))},o)}}clearConnectionTimeout(e){let t=this.peerConnections.get(e);t&&t.connectionTimeout&&(clearTimeout(t.connectionTimeout),t.connectionTimeout=void 0)}emitConnectionError(e,t){window.dispatchEvent(new CustomEvent("webrtc-connection-error",{detail:{userId:e,errorType:t}}))}attemptReconnect(e){let t=this.reconnectAttempts.get(e)||0;if(t<this.maxReconnectAttempts){let n=t+1;console.log("Attempting to reconnect to ".concat(e,", attempt ").concat(n,"/").concat(this.maxReconnectAttempts)),this.reconnectAttempts.set(e,n);let o=Math.min(1e3*Math.pow(1.5,t),8e3);console.log("Waiting ".concat(o,"ms before reconnect attempt ").concat(n)),setTimeout(()=>{let t=this.peerConnections.get(e);if(t&&("connected"===t.connection.iceConnectionState||"completed"===t.connection.iceConnectionState)){console.log("Connection restored during reconnect delay. Cancelling reconnect.");return}this.socket.emit("webrtc_reconnect_request",e),this.restartIceForPeer(e)},o)}else console.error("Failed to connect to ".concat(e," after ").concat(t," attempts")),this.reconnectAttempts.delete(e),window.dispatchEvent(new CustomEvent("peer-connection-failed",{detail:{userId:e,message:"Connection failed after multiple attempts. Please try again later."}})),this.removePeerConnection(e)}handleReconnectRequest(e){let t=this.peerConnections.get(e);t?(console.log("Handling reconnect request from ".concat(e)),this.restartIceForPeer(e)):this.initiateCall(e)}async addPendingIceCandidates(e){let t=this.peerConnections.get(e);if(t&&t.pendingIceCandidates&&t.pendingIceCandidates.length>0){for(let n of(console.log("Adding ".concat(t.pendingIceCandidates.length," pending ICE candidates for ").concat(e)),t.pendingIceCandidates))try{await t.connection.addIceCandidate(new RTCIceCandidate(n))}catch(e){console.error("Error adding pending ICE candidate:",e)}t.pendingIceCandidates=[]}}async createPeerConnection(e){let t;this.removePeerConnection(e),console.log("Creating new peer connection for ".concat(e));let n=new RTCPeerConnection(this.connectionConfig);try{(t=await this.getLocalStream()).getTracks().forEach(e=>{n.addTrack(e,t)})}catch(e){throw console.error("Failed to get local stream:",e),e}this.reconnectAttempts.set(e,0);let o=setTimeout(()=>{if("complete"!==n.iceGatheringState&&(console.log("ICE gathering taking too long for ".concat(e,", proceeding anyway")),n.onicegatheringstatechange=null,n.localDescription)){let e=new Event("icegatheringstatechange");n.dispatchEvent(e)}},this.iceGatheringTimeoutDuration);n.onicegatheringstatechange=()=>{console.log("ICE gathering state changed to: ".concat(n.iceGatheringState," for ").concat(e)),"complete"===n.iceGatheringState&&o&&(clearTimeout(o),o=null)},n.onicecandidate=t=>{t.candidate?(console.log("Sending ICE candidate to ".concat(e),t.candidate),this.socket.emit("webrtc_ice_candidate",t.candidate,e)):console.log("ICE candidate gathering completed for ".concat(e))},n.oniceconnectionstatechange=()=>{console.log("ICE connection state change: ".concat(n.iceConnectionState," for user ").concat(e)),window.dispatchEvent(new CustomEvent("ice-connection-state-change",{detail:{userId:e,state:n.iceConnectionState}})),"connected"===n.iceConnectionState||"completed"===n.iceConnectionState?(this.reconnectAttempts.set(e,0),this.clearConnectionTimeout(e)):("failed"===n.iceConnectionState||"disconnected"===n.iceConnectionState)&&(console.warn("Connection ".concat(n.iceConnectionState," for ").concat(e,", attempting ICE restart")),this.attemptReconnect(e))},n.ontrack=t=>{let[n]=t.streams;console.log("Received track from ".concat(e),t.track.kind);let o=this.peerConnections.get(e);o&&(o.stream=n),window.dispatchEvent(new CustomEvent("remote-stream-updated",{detail:{userId:e,stream:n}}))},n.onconnectionstatechange=()=>{console.log("Connection state change: ".concat(n.connectionState," for user ").concat(e)),"connected"===n.connectionState?(this.reconnectAttempts.set(e,0),this.clearConnectionTimeout(e)):("closed"===n.connectionState||"failed"===n.connectionState)&&(window.dispatchEvent(new CustomEvent("peer-connection-failed",{detail:{userId:e}})),"failed"===n.connectionState&&this.attemptReconnect(e))};let r={connection:n,stream:t};return this.peerConnections.set(e,r),this.monitorConnectionStats(e),r}async restartIceForPeer(e){let t=this.peerConnections.get(e);if(t)try{console.log("Restarting ICE for ".concat(e));let n=await t.connection.createOffer({iceRestart:!0});await t.connection.setLocalDescription(n),this.socket.emit("webrtc_offer",n,e),this.setConnectionTimeout(e)}catch(t){console.error("Error restarting ICE:",t),this.emitConnectionError(e,"ice-restart-error")}else console.warn("Cannot restart ICE: No peer connection found for ".concat(e))}async getStream(){return this.getLocalStream()}async tryGetUserMedia(e){try{return console.log("Requesting media with constraints:",e),await navigator.mediaDevices.getUserMedia(e)}catch(t){throw console.error("Error with constraints:",e,t),t}}async getLocalStream(){if(this.localStream)return this.localStream;let e=null;for(let t of[{video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!0},{video:!0,audio:!0},{video:!0,audio:!1},{video:!1,audio:!0}])try{return console.log("Attempting to get media with constraints:",t),this.localStream=await this.tryGetUserMedia(t),t.video&&this.localStream&&0===this.localStream.getVideoTracks().length&&(console.log("Adding black video track as fallback"),this.addBlackVideoTrack(this.localStream)),this.localStream}catch(n){console.error("Failed to get media with constraints:",t,n),e=n}throw console.error("Failed to access any media devices after trying all options"),e||Error("Failed to access media devices")}addBlackVideoTrack(e){try{let t=document.createElement("canvas");t.width=640,t.height=480;let n=t.getContext("2d");n&&(n.fillStyle="black",n.fillRect(0,0,t.width,t.height),n.font="24px Arial",n.fillStyle="white",n.textAlign="center",n.fillText("Camera Off",t.width/2,t.height/2),setInterval(()=>{n&&(n.fillStyle="black",n.fillRect(0,0,t.width,t.height),n.font="24px Arial",n.fillStyle="white",n.textAlign="center",n.fillText("Camera Off",t.width/2,t.height/2),n.font="12px Arial",n.fillText(new Date().toLocaleTimeString(),t.width/2,t.height-20))},1e3));let o=t.captureStream(5),[r]=o.getVideoTracks();r&&(r.enabled=!1,e.addTrack(r))}catch(e){console.error("Failed to create fallback video track:",e)}}async initiateCall(e){try{console.log("Initiating call to ".concat(e));let t=await this.createPeerConnection(e),n=await t.connection.createOffer();await t.connection.setLocalDescription(n),this.socket.emit("webrtc_offer",n,e),this.setConnectionTimeout(e)}catch(t){throw console.error("Error initiating call:",t),this.emitConnectionError(e,"initiate-call-error"),t}}async toggleAudio(e){if(this.localStream){let t=this.localStream.getAudioTracks();if(t.length>0)t.forEach(t=>{t.enabled=e}),console.log("Audio ".concat(e?"enabled":"disabled"));else if(e)try{console.log("Attempting to add audio track");let e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),[t]=e.getAudioTracks();t&&this.localStream&&(this.localStream.addTrack(t),console.log("Audio track added successfully"))}catch(e){throw console.error("Failed to add audio track:",e),e}}}async toggleVideo(e){if(this.localStream){let t=this.localStream.getVideoTracks();if(t.length>0)t.forEach(t=>{t.enabled=e}),console.log("Video ".concat(e?"enabled":"disabled"));else if(e)try{console.log("Attempting to add video track");let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),[t]=e.getVideoTracks();t&&this.localStream&&(this.localStream.addTrack(t),console.log("Video track added successfully"))}catch(e){throw console.error("Failed to add video track:",e),this.addBlackVideoTrack(this.localStream),e}}}getPeerConnection(e){return this.peerConnections.get(e)}getAllPeerConnections(){return this.peerConnections}removePeerConnection(e){let t=this.peerConnections.get(e);t&&(console.log("Removing peer connection for ".concat(e)),window.dispatchEvent(new CustomEvent("peer-disconnected",{detail:{userId:e}})),this.clearConnectionTimeout(e),t.connection.close(),this.peerConnections.delete(e),this.reconnectAttempts.delete(e),this.clearStatsMonitoring(e))}cleanup(){console.log("Cleaning up all WebRTC connections"),this.peerConnections.forEach((e,t)=>{window.dispatchEvent(new CustomEvent("peer-disconnected",{detail:{userId:t}})),this.clearConnectionTimeout(t),e.connection.close()}),this.peerConnections.clear(),this.reconnectAttempts.clear(),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null)}monitorConnectionStats(e){let t=this.peerConnections.get(e);if(!t)return;let n=t.connection,o=setInterval(async()=>{if(!this.peerConnections.has(e)){clearInterval(o);return}try{let t=await n.getStats(),o=!1,r=!1;t.forEach(e=>{if("inbound-rtp"===e.type&&"video"===e.kind&&e.packetsLost>0){let t=e.packetsLost/e.packetsReceived;t>.05&&(o=!0,console.warn("High packet loss detected: ".concat(Math.round(100*t),"%")))}"candidate-pair"===e.type&&"succeeded"===e.state&&e.currentRoundTripTime&&e.currentRoundTripTime>.5&&(r=!0,console.warn("High latency detected: ".concat(Math.round(1e3*e.currentRoundTripTime),"ms")))}),(o||r)&&window.dispatchEvent(new CustomEvent("webrtc-connection-quality-issue",{detail:{userId:e,packetLoss:o,highLatency:r,message:"Poor connection quality detected."}}))}catch(e){console.error("Error monitoring connection stats:",e)}},5e3);this.statsIntervals.set(e,o)}clearStatsMonitoring(e){let t=this.statsIntervals.get(e);t&&(clearInterval(t),this.statsIntervals.delete(e))}constructor(e){this.peerConnections=new Map,this.localStream=null,this.connectionConfig={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.voip.blackberry.com:3478"},{urls:["turn:global.turn.twilio.com:3478?transport=udp","turn:global.turn.twilio.com:3478?transport=tcp","turn:global.turn.twilio.com:443?transport=tcp"],username:"f4b4035eaa76f4a55de5f4351567653ee4ff6fa97b50b6b334fcc1be9c27212d",credential:"myL7H4oVB1bVY01+IwRMVQNPAQ0Cca2vrZe6YGmNWQU="},{urls:"turn:relay.metered.ca:80",username:"83e9c6e53a6b355601d8bf78",credential:"SJgHvzXnhh5iNXhc"},{urls:"turn:relay.metered.ca:443",username:"83e9c6e53a6b355601d8bf78",credential:"SJgHvzXnhh5iNXhc"},{urls:"turn:relay.metered.ca:443?transport=tcp",username:"83e9c6e53a6b355601d8bf78",credential:"SJgHvzXnhh5iNXhc"}],iceCandidatePoolSize:10},this.reconnectAttempts=new Map,this.maxReconnectAttempts=5,this.connectionTimeoutDuration=45e3,this.iceGatheringTimeoutDuration=2e4,this.statsIntervals=new Map,this.socket=e,this.setupSocketListeners()}},ev=e=>{let{userId:t}=e,[n,o]=(0,i.useState)(!0),[a,s]=(0,i.useState)(!0),[c,u]=(0,i.useState)(!1),[h,m]=(0,i.useState)(!1),[g,x]=(0,i.useState)(null),[p,v]=(0,i.useState)(!1),b=(0,i.useRef)(null),w=(0,i.useRef)(null),y=(0,i.useRef)(null),C=(0,i.useRef)(null),j=(0,i.useCallback)(()=>{C.current&&(clearTimeout(C.current),C.current=null)},[]);(0,i.useEffect)(()=>{let e=async()=>{try{m(!0),b.current=new ep(d.W);let e=await b.current.getStream();w.current&&(w.current.srcObject=e),m(!1)}catch(e){console.error("Error accessing media devices:",e),x("Could not access camera or microphone"),m(!1)}};e();let n=e=>{let{userId:n,stream:o}=e.detail;n===t&&y.current&&(y.current.srcObject=o,u(!0),m(!1),j())};return window.addEventListener("remote-stream-updated",n),()=>{var e;window.removeEventListener("remote-stream-updated",n),j(),null===(e=b.current)||void 0===e||e.cleanup()}},[t,j]),(0,i.useEffect)(()=>{let e=e=>{u(!1),l.Am.error("".concat(e.detail.message||"Call ended unexpectedly")),y.current&&y.current.srcObject&&(y.current.srcObject=null)},t=e=>{u(!1),m(!1),l.Am.error("".concat(e.detail.message||"Call connection failed")),y.current&&y.current.srcObject&&(y.current.srcObject=null)},n=e=>{u(!1),m(!1),l.Am.error("".concat(e.detail.message||"Call connection timed out")),y.current&&y.current.srcObject&&(y.current.srcObject=null)};return window.addEventListener("peer-disconnected",e),window.addEventListener("peer-connection-failed",t),window.addEventListener("peer-connection-timeout",n),()=>{window.removeEventListener("peer-disconnected",e),window.removeEventListener("peer-connection-failed",t),window.removeEventListener("peer-connection-timeout",n)}},[]),(0,i.useEffect)(()=>{let e=e=>{let{userId:n,state:o}=e.detail;n===t&&("failed"===o||"disconnected"===o?(x("Connection ".concat(o,". Try refreshing.")),c&&u(!1)):("connected"===o||"completed"===o)&&(x(null),u(!0),m(!1),j()))};return window.addEventListener("ice-connection-state-change",e),()=>{window.removeEventListener("ice-connection-state-change",e)}},[t,c,j]);let k=async()=>{if(b.current)try{x(null),m(!0),j(),await b.current.initiateCall(t),C.current=setTimeout(()=>{c||(m(!1),x("Call connection timed out. Please try again."),b.current&&!c&&setTimeout(()=>{c||h||(l.Am.info("Attempting to reconnect automatically..."),k().catch(e=>{console.error("Auto-reconnect failed:",e),x("Automatic reconnect failed. Please try manually.")}))},2e3))},2e4)}catch(e){console.error("Failed to start call:",e),x("Failed to start call. Please try again."),m(!1)}},E=async()=>{if(b.current)try{let e=!n;await b.current.toggleAudio(e),o(e)}catch(e){console.error("Error toggling audio:",e),x("Could not toggle audio")}},N=async()=>{if(b.current)try{let e=!a;await b.current.toggleVideo(e),s(e)}catch(e){console.error("Error toggling video:",e),x("Could not toggle video")}},S=()=>{v(!p)};return p?(0,r.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,r.jsx)("button",{onClick:S,className:"flex h-12 w-12 items-center justify-center rounded-full bg-blue-500 text-white shadow-lg hover:bg-blue-600","aria-label":"Expand video chat",children:(0,r.jsx)(f.gts,{className:"h-6 w-6"})})}):(0,r.jsxs)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col items-end gap-2 rounded-lg bg-gray-900/90 p-3 shadow-xl backdrop-blur-sm",children:[g&&(0,r.jsx)("div",{className:"mb-2 w-full rounded bg-red-500/80 px-2 py-1 text-sm text-white",children:g}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:S,className:"rounded-md bg-gray-700 p-1 text-white hover:bg-gray-600","aria-label":"Minimize",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})})})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("video",{ref:w,autoPlay:!0,muted:!0,playsInline:!0,className:"h-32 w-48 rounded-lg bg-black object-cover ".concat(a?"":"opacity-50")}),!a&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)(f.kwV,{className:"h-8 w-8 text-white"})}),h&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:(0,r.jsx)(ed.fCD,{className:"h-8 w-8 animate-spin text-white"})}),(0,r.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-black/50 px-1 text-xs text-white",children:"You"})]}),c&&(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("video",{ref:y,autoPlay:!0,playsInline:!0,className:"h-32 w-48 rounded-lg bg-black object-cover"}),(0,r.jsx)("div",{className:"absolute bottom-1 left-1 rounded bg-black/50 px-1 text-xs text-white",children:"Remote"})]}),!c&&h&&(0,r.jsx)("div",{className:"relative flex h-32 w-48 items-center justify-center rounded-lg bg-black",children:(0,r.jsxs)("div",{className:"text-center text-white",children:[(0,r.jsx)(ed.fCD,{className:"mx-auto h-8 w-8 animate-spin"}),(0,r.jsx)("div",{className:"mt-2 text-xs",children:"Connecting..."})]})})]}),(0,r.jsxs)("div",{className:"mt-2 flex w-full justify-center gap-2",children:[(0,r.jsx)("button",{onClick:c?()=>{if(b.current)try{j(),b.current.cleanup(),u(!1),m(!1);let e=async()=>{m(!0),b.current=new ep(d.W);let e=await b.current.getStream();w.current&&(w.current.srcObject=e),m(!1)};e().catch(e=>{console.error("Error reinitializing after call:",e),x("Error reinitializing after call"),m(!1)})}catch(e){console.error("Error ending call:",e),x("Error ending call"),m(!1)}}:k,className:"flex h-10 w-10 items-center justify-center rounded-full ".concat(c?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"," text-white"),disabled:h,"aria-label":c?"End call":"Start call",children:h?(0,r.jsx)(ed.fCD,{className:"h-5 w-5 animate-spin"}):c?(0,r.jsx)(ex.P8R,{className:"h-5 w-5"}):(0,r.jsx)(ex.fFs,{className:"h-5 w-5"})}),(0,r.jsx)("button",{onClick:E,className:"flex h-10 w-10 items-center justify-center rounded-full ".concat(n?"bg-blue-500 hover:bg-blue-600":"bg-gray-500 hover:bg-gray-600"," text-white"),disabled:!c||h,"aria-label":n?"Mute audio":"Unmute audio",children:n?(0,r.jsx)(f.Ln0,{className:"h-5 w-5"}):(0,r.jsx)(f.P2d,{className:"h-5 w-5"})}),(0,r.jsx)("button",{onClick:N,className:"flex h-10 w-10 items-center justify-center rounded-full ".concat(a?"bg-blue-500 hover:bg-blue-600":"bg-gray-500 hover:bg-gray-600"," text-white"),disabled:!c||h,"aria-label":a?"Turn off camera":"Turn on camera",children:a?(0,r.jsx)(f.gts,{className:"h-5 w-5"}):(0,r.jsx)(f.kwV,{className:"h-5 w-5"})})]})]})},eb=()=>{let e=(0,a.NW)(),t=(0,i.useRef)(null),[n,o]=(0,i.useState)(!1),[s,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),[h,m]=(0,eh.Z)([]);return(0,i.useEffect)(()=>{let n=(n,r)=>{var a,i;let l=e.users.get(n);m.push({userId:n,msg:r,id:h.length+1,username:(null==l?void 0:l.name)||"Anonymous",color:(null==l?void 0:l.color)||"#000"}),null===(i=t.current)||void 0===i||i.scroll({top:null===(a=t.current)||void 0===a?void 0:a.scrollHeight}),s||o(!0)};return d.W.on("new_msg",n),()=>{d.W.off("new_msg",n)}},[m,h,s,e.users]),(0,r.jsxs)(g.E.div,{className:"absolute bottom-0 z-50 flex h-[300px] w-full flex-col overflow-hidden rounded-t-md sm:left-36 sm:w-[30rem]",animate:{y:s?0:260},transition:{ease:em.n,duration:.2},children:[(0,r.jsxs)("button",{className:"flex w-full cursor-pointer items-center justify-between bg-zinc-900 py-2 px-10 font-semibold text-white",onClick:()=>{l(e=>!e),o(!1)},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(f.Nm2,{className:"mt-[-2px]"}),"Chat",n&&(0,r.jsx)("p",{className:"rounded-md bg-green-500 px-1 font-semibold text-green-900",children:"New!"})]}),(0,r.jsx)(g.E.div,{animate:{rotate:s?0:180},transition:{ease:em.n,duration:.2},children:(0,r.jsx)(ed.RiI,{})})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col justify-between bg-white p-3",children:[(0,r.jsx)("div",{className:"h-[190px] overflow-y-scroll pr-2",ref:t,children:h.map(e=>(0,r.jsx)(ef,{...e},e.id))}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eg,{}),(0,r.jsx)("button",{onClick:()=>u(!c),className:"rounded-full bg-green-500 p-2 text-white hover:bg-green-600","aria-label":"Toggle video call",children:(0,r.jsx)(eu.DsV,{})})]}),c&&(0,r.jsx)(ev,{userId:e.userId})]})]})},ew=n(1163),ey=n(4922),eC=n(9477),ej=()=>{let e=(0,a.u4)(),{openModal:t}=(0,ey.d)(),[n,o]=(0,i.useState)(""),s=(0,ew.useRouter)(),l=(s.query.roomId||"").toString();return(0,i.useEffect)(()=>{if(l)return d.W.emit("check_room",l),d.W.on("room_exists",e=>{e||s.push("/")}),()=>{d.W.off("room_exists")}},[l,s]),(0,i.useEffect)(()=>{let n=(n,o)=>{o?(s.push("/"),t((0,r.jsx)(eC.Z,{id:n}))):e(n)};return d.W.on("joined",n),()=>{d.W.off("joined",n)}},[t,s,e]),(0,r.jsxs)("form",{className:"my-24 flex flex-col items-center",onSubmit:e=>{e.preventDefault(),n.trim()&&d.W.emit("join_room",l,n.trim())},children:[(0,r.jsx)("h1",{className:"text-5xl font-extrabold leading-tight sm:text-extra",children:"Collaborator"}),(0,r.jsx)("h3",{className:"text-xl sm:text-2xl",children:"Real-time whiteboard"}),(0,r.jsxs)("div",{className:"mt-10 flex flex-col gap-2",children:[(0,r.jsx)("label",{className:"self-start font-bold leading-tight",children:"Enter your name"}),(0,r.jsx)("input",{type:"text",value:n,onChange:e=>o(e.target.value),placeholder:"John Doe",className:"rounded-lg border border-gray-300 p-2 text-lg focus:border-gray-600 focus:outline-none",required:!0})]}),(0,r.jsx)("button",{type:"submit",className:"mt-6 rounded-lg bg-gray-800 px-6 py-2 text-white transition-colors hover:bg-gray-700 disabled:cursor-not-allowed disabled:bg-opacity-50",disabled:!n.trim(),children:"Join Room"})]})},ek=n(3854),eE=n(3990),eN=n(1649),eS=()=>{let{id:e}=(0,a.NW)(),{closeModal:t}=(0,ey.d)(),[n,o]=(0,i.useState)("");return(0,i.useEffect)(()=>o(window.location.href),[]),(0,r.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10 pt-5",children:[(0,r.jsx)("button",{onClick:t,className:"absolute top-5 right-5",children:(0,r.jsx)(ei.oHP,{})}),(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Invite"}),(0,r.jsxs)("h3",{children:["Room id: ",(0,r.jsx)("p",{className:"inline font-bold",children:e})]}),(0,r.jsxs)("div",{className:"relative mt-2",children:[(0,r.jsx)("input",{type:"text",value:n,readOnly:!0,className:"input sm:w-96"}),(0,r.jsx)("button",{className:"btn absolute right-0 h-full",onClick:()=>navigator.clipboard.writeText(n),children:"Copy"})]})]})},eT=n(471),eM=()=>{let{closeModal:e}=(0,ey.d)(),t=B(),n=Z();(0,i.useEffect)(()=>e,[n,e]);let o=(e,t,n)=>{let o=null==e?void 0:e.getContext("2d");if(o&&(o.fillStyle="dark"===t?"#222":"#fff",o.fillRect(0,0,o.canvas.width,o.canvas.height),n)){o.lineWidth=1,o.strokeStyle="dark"===t?"#444":"#ddd";for(let e=0;e<o.canvas.height;e+=10)o.beginPath(),o.moveTo(0,e),o.lineTo(o.canvas.width,e),o.stroke();for(let e=0;e<o.canvas.width;e+=10)o.beginPath(),o.moveTo(e,0),o.lineTo(e,o.canvas.height),o.stroke()}};return(0,r.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10",children:[(0,r.jsx)("button",{onClick:e,className:"absolute top-5 right-5",children:(0,r.jsx)(ei.oHP,{})}),(0,r.jsx)("h2",{className:"mb-4 text-2xl font-bold",children:"Choose background"}),(0,r.jsxs)("div",{className:"grid gap-5 sm:grid-cols-2",children:[(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("dark",!0),ref:e=>o(e,"dark",!0)}),(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("light",!0),ref:e=>o(e,"light",!0)}),(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("dark",!1),ref:e=>o(e,"dark",!1)}),(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("light",!1),ref:e=>o(e,"light",!1)})]})]})},eR=()=>{let{openModal:e}=(0,ey.d)();return(0,r.jsx)("button",{className:"btn-icon",onClick:()=>e((0,r.jsx)(eM,{})),children:(0,r.jsx)(eT.bTn,{})})},eI=n(1190),eW=n(5907),eL=n(9293);let eA={from:{y:-30,opacity:0,transition:{ease:em.n,duration:.2}},to:{y:0,opacity:1,transition:{ease:em.n,duration:.2}}};var eP=()=>{let[e,t]=R(),n=(0,i.useRef)(null),[o,a]=(0,i.useState)(!1);return(0,eL.Z)(n,()=>a(!1)),(0,r.jsxs)("div",{className:"relative flex items-center",ref:n,children:[(0,r.jsx)("button",{className:"btn-icon",onClick:()=>a(!o),disabled:"select"===e.mode,children:(0,r.jsx)(f.woE,{})}),(0,r.jsx)(eI.M,{children:o&&(0,r.jsxs)(g.E.div,{className:"absolute left-10 mt-24 sm:left-14",variants:eA,initial:"from",animate:"to",exit:"from",children:[(0,r.jsx)("h2",{className:"ml-3 font-semibold text-black dark:text-white",children:"Line color"}),(0,r.jsx)(eW.Jg,{color:e.lineColor,onChange:n=>{t({...e,lineColor:n})},className:"mb-5"}),(0,r.jsx)("h2",{className:"ml-3 font-semibold text-black dark:text-white",children:"Fill color"}),(0,r.jsx)(eW.Jg,{color:e.fillColor,onChange:n=>{t({...e,fillColor:n})}})]})})]})},eD=()=>{let{redoRef:e,undoRef:t}=y(),{myMoves:n}=(0,a.av)(),o=A();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"btn-icon text-xl",ref:e,disabled:!o.length,children:(0,r.jsx)(ed.WLu,{})}),(0,r.jsx)("button",{className:"btn-icon text-xl",ref:t,disabled:!n.length,children:(0,r.jsx)(ed.wXW,{})})]})},e_=n(6770),eF=n.n(e_);let ez=(e,t)=>{eF().imageFileResizer(e,700,700,"WEBP",100,0,e=>{t(e.toString())},"base64")};var eO=()=>{let{setMoveImage:e}=H();return(0,i.useEffect)(()=>{let t=t=>{var n;let o=null===(n=t.clipboardData)||void 0===n?void 0:n.items;if(o){for(let t of o)if(t.type.includes("image")){let n=t.getAsFile();n&&ez(n,t=>e({base64:t}))}}};return document.addEventListener("paste",t),()=>{document.removeEventListener("paste",t)}},[e]),(0,r.jsx)("button",{className:"btn-icon text-xl",onClick:()=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.click(),t.addEventListener("change",()=>{if(t&&t.files){let n=t.files[0];ez(n,t=>e({base64:t}))}})},children:(0,r.jsx)(f.vGR,{})})},eX=()=>{let[e,t]=R(),n=(0,i.useRef)(null),[o,a]=(0,i.useState)(!1);return(0,eL.Z)(n,()=>a(!1)),(0,r.jsxs)("div",{className:"relative flex items-center",ref:n,children:[(0,r.jsx)("button",{className:"btn-icon text-xl",onClick:()=>a(!o),disabled:"select"===e.mode,children:(0,r.jsx)(f.S2O,{})}),(0,r.jsx)(eI.M,{children:o&&(0,r.jsx)(g.E.div,{className:"absolute top-[6px] left-14 w-36",variants:eA,initial:"from",animate:"to",exit:"from",children:(0,r.jsx)("input",{type:"range",min:1,max:20,value:e.lineWidth,onChange:e=>t(t=>({...t,lineWidth:parseInt(e.target.value,10)})),className:"h-4 w-full cursor-pointer appearance-none rounded-lg bg-gray-200"})})})]})},eU=()=>{let[e,t]=R(),{clearSelection:n}=I();return(0,i.useEffect)(()=>{n()},[e.mode]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"btn-icon text-xl ".concat("draw"===e.mode&&"bg-green-400"),onClick:()=>{t(e=>({...e,mode:"draw"}))},children:(0,r.jsx)(f.Aac,{})}),(0,r.jsx)("button",{className:"btn-icon text-xl ".concat("eraser"===e.mode&&"bg-green-400"),onClick:()=>{t(e=>({...e,mode:"eraser"}))},children:(0,r.jsx)(ed.arg,{})}),(0,r.jsx)("button",{className:"btn-icon text-2xl ".concat("select"===e.mode&&"bg-green-400"),onClick:()=>{t(e=>({...e,mode:"select"}))},children:(0,r.jsx)(ei.AJi,{})})]})},eV=n(7516),eZ=()=>{let[e,t]=R(),n=(0,i.useRef)(null),[o,a]=(0,i.useState)(!1),[s,l]=(0,i.useState)(!1);(0,eL.Z)(n,()=>a(!1));let c=e=>{t(t=>({...t,shape:e})),a(!1)},d="select"===e.mode;return(0,r.jsxs)("div",{className:"relative flex items-center",ref:n,children:[(0,r.jsxs)("button",{className:"btn-icon relative text-2xl ".concat(d?"cursor-not-allowed opacity-50":""),disabled:d,onClick:()=>!d&&a(e=>!e),onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:["circle"===e.shape&&(0,r.jsx)(f.b9R,{}),"rect"===e.shape&&(0,r.jsx)(eV.v3P,{}),"line"===e.shape&&(0,r.jsx)(eT.slm,{}),s&&(0,r.jsx)("div",{className:"absolute -top-10 left-1/2 z-50 -translate-x-1/2 transform whitespace-nowrap rounded bg-black bg-opacity-75 py-1 px-2 text-xs text-white",children:d?"Not available in select mode":"Choose shape"})]}),(0,r.jsx)(eI.M,{children:o&&(0,r.jsxs)(g.E.div,{className:"absolute left-14 z-10 flex gap-1 rounded-lg border bg-zinc-900 p-2 md:border-0",variants:eA,initial:"from",animate:"to",exit:"from",children:[(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>c("line"),"aria-label":"Line shape",children:(0,r.jsx)(eT.slm,{})}),(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>c("rect"),"aria-label":"Rectangle shape",children:(0,r.jsx)(eV.v3P,{})}),(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>c("circle"),"aria-label":"Circle shape",children:(0,r.jsx)(f.b9R,{})})]})})]})},eB=()=>{let{canvasRef:e,bgRef:t}=y(),{openModal:n}=(0,ey.d)(),{width:o}=b(),[a,s]=(0,i.useState)(!1),[l,c]=(0,i.useState)(null),d=(0,ew.useRouter)();return(0,i.useEffect)(()=>{o>=1024?s(!0):s(!1)},[o]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.E.button,{className:"btn-icon absolute bottom-1/2 -left-2 z-50 h-10 w-10 rounded-full bg-black text-2xl transition-none lg:hidden",animate:{rotate:a?0:180},transition:{duration:.25,ease:em.n},onClick:()=>s(!a),"aria-label":a?"Close toolbar":"Open toolbar",children:(0,r.jsx)(el.Tfp,{})}),(0,r.jsxs)(g.E.div,{className:"absolute left-10 top-[50%] z-50 grid grid-cols-2 items-center gap-5 rounded-lg bg-zinc-900 p-5 text-white shadow-lg 2xl:grid-cols-1",animate:{x:a?0:-160,y:"-50%",opacity:a?1:.8},transition:{duration:.25,ease:em.n},"aria-hidden":!a,children:[(0,r.jsx)(eD,{}),(0,r.jsx)("div",{className:"h-px w-full bg-white 2xl:hidden"}),(0,r.jsx)("div",{className:"h-px w-full bg-white"}),(0,r.jsx)(eZ,{}),(0,r.jsx)(eP,{}),(0,r.jsx)(eX,{}),(0,r.jsx)(eU,{}),(0,r.jsx)(eO,{}),(0,r.jsx)("div",{className:"2xl:hidden"}),(0,r.jsx)("div",{className:"h-px w-full bg-white 2xl:hidden"}),(0,r.jsx)("div",{className:"h-px w-full bg-white"}),(0,r.jsx)(eR,{}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>n((0,r.jsx)(eS,{})),onMouseEnter:()=>c("Share"),onMouseLeave:()=>c(null),"aria-label":"Share whiteboard",children:(0,r.jsx)(eN.qSo,{})}),"Share"===l&&(0,r.jsx)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 transform whitespace-nowrap rounded bg-black bg-opacity-75 py-1 px-2 text-xs text-white",children:"Share"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>{let n=document.createElement("canvas");n.width=v.width,n.height=v.height;let o=n.getContext("2d");o&&e.current&&t.current&&(o.drawImage(t.current,0,0),o.drawImage(e.current,0,0));let r=document.createElement("a");r.href=n.toDataURL("image/png"),r.download="canvas.png",r.click()},onMouseEnter:()=>c("Download"),onMouseLeave:()=>c(null),"aria-label":"Download whiteboard",children:(0,r.jsx)(ek.yFZ,{})}),"Download"===l&&(0,r.jsx)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 transform whitespace-nowrap rounded bg-black bg-opacity-75 py-1 px-2 text-xs text-white",children:"Download"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{className:"btn-icon text-xl",onClick:()=>d.push("/"),onMouseEnter:()=>c("Exit"),onMouseLeave:()=>c(null),"aria-label":"Exit whiteboard",children:(0,r.jsx)(eE.T$9,{})}),"Exit"===l&&(0,r.jsx)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 transform whitespace-nowrap rounded bg-black bg-opacity-75 py-1 px-2 text-xs text-white",children:"Exit"})]})]})]})},eH=()=>{let{users:e}=(0,a.NW)();return(0,r.jsx)("div",{className:"pointer-events-none absolute z-30 flex p-5",children:[...e.keys()].map((t,n)=>{var o,a;return(0,r.jsx)("div",{className:"flex h-5 w-5 select-none items-center justify-center rounded-full text-xs text-white md:h-8 md:w-8 md:text-base lg:h-12 lg:w-12",style:{backgroundColor:(null===(o=e.get(t))||void 0===o?void 0:o.color)||"black",marginLeft:0!==n?"-0.5rem":0},children:(null===(a=e.get(t))||void 0===a?void 0:a.name.split("")[0])||"A"},t)})})},eJ=()=>{let e=(0,a.NW)();return e.id?(0,r.jsx)(m,{children:(0,r.jsxs)("div",{className:"relative h-full w-full overflow-hidden",children:[(0,r.jsx)(eH,{}),(0,r.jsx)(eB,{}),(0,r.jsx)(ec,{}),(0,r.jsx)(es,{}),(0,r.jsx)(ee,{}),(0,r.jsx)(eo,{}),(0,r.jsx)(ea,{}),(0,r.jsx)(eb,{})]})}):(0,r.jsx)(ej,{})},eY=()=>(0,r.jsx)(eJ,{})}},function(e){e.O(0,[617,228,260,866,609,556,445,955,13,874,642,494,774,888,179],function(){return e(e.s=7933)}),_N_E=e.O()}]);